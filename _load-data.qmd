```{r}
# dataset <- redivis::organization("datapages")$dataset("palmerpenguins")
# penguins <- dataset$table("penguins")$to_tibble()
# ojs_define(data = penguins)
```

```{r}
library(redivis)
quarto <- yaml::read_yaml("_quarto.yml")

# load data from redivis table if specified in yaml
if ("redivis" %in% names(quarto) &&
    all(c("user", "table") %in% names(quarto$redivis)) && # need user and table
    any(c("dataset", "workflow") %in% names(quarto$redivis))) { # need dataset or workflow
  if (!is.null(quarto$redivis$dataset)) {
    # use dataset if provided
    dataset <- redivis$user(quarto$redivis$user)$dataset(quarto$redivis$dataset)
  } else {
    # otherwise use workflow
    dataset <- redivis$user(quarto$redivis$user)$workflow(quarto$redivis$workflow)
  }
  
  # get table data
  table <- dataset$table(quarto$redivis$table)
  data <- table$to_tibble()

  # get variable metadata
  vars <- map(table$list_variables(), \(v) c(v$get()$properties, v$get_statistics()))

  # pass to OJS
  ojs_define(data = data)
  ojs_define(vars = vars)
  
} else {
  ojs_define(data = NULL)
  ojs_define(vars = NULL)
}
```
